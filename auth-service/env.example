# Auth Service Environment Configuration
# Copy this file to .env and update the values as needed

# Application Configuration
APP_ENV=development

# Server Configuration
SERVER_PORT=8085
SERVER_HOST=0.0.0.0
SERVER_READ_TIMEOUT=30s
SERVER_WRITE_TIMEOUT=30s
SERVER_IDLE_TIMEOUT=120s

# Database Configuration
DATABASE_TYPE=postgres
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=auth_user
DATABASE_PASSWORD=auth_password
DATABASE_NAME=auth_service
DATABASE_SSL_MODE=disable
DATABASE_MAX_CONNECTIONS=25
DATABASE_MAX_IDLE_CONNECTIONS=5
DATABASE_CONNECTION_MAX_LIFETIME=1h

# Cache (Redis) Configuration
CACHE_NAME=auth-cache
CACHE_ADDR=localhost:6379
CACHE_PASSWORD=
CACHE_DB=0
CACHE_USE_CLUSTER=false
CACHE_CLUSTER_ADDRS=[]
CACHE_POOL_SIZE=10
CACHE_MIN_IDLE_CONNS=5
CACHE_MAX_RETRIES=3
CACHE_DIAL_TIMEOUT=5s
CACHE_READ_TIMEOUT=3s
CACHE_WRITE_TIMEOUT=3s

# JWT Configuration
JWT_SECRET=your-secret-key-here-change-in-production
JWT_EXPIRATION=24h
JWT_REFRESH_EXPIRATION=168h
JWT_ISSUER=auth-service
JWT_AUDIENCE=auth-service-api
JWT_ALGORITHM=HS256
JWT_BCRYPT_COST=10

# MFA Configuration
MFA_REQUIRED_FACTORS=["totp"]
MFA_OPTIONAL_FACTORS=["sms", "email", "push"]
MFA_RISK_BASED=true
MFA_THRESHOLD=0.7
MFA_FACTOR_TIMEOUT=5m
MFA_MAX_ATTEMPTS=3
MFA_BACKUP_CODES=true
MFA_BACKUP_CODE_COUNT=10

# SSO Configuration
SSO_TOKEN_VALIDATION_INTERVAL=5m
SSO_SESSION_TIMEOUT=8h
SSO_REFRESH_THRESHOLD=1h
SSO_MAX_CONCURRENT_SESSIONS=5

# Session Configuration
SESSION_DEFAULT_TIMEOUT=8h
SESSION_IDLE_TIMEOUT=2h
SESSION_MAX_SESSIONS=5
SESSION_REFRESH_THRESHOLD=1h
SESSION_CLEANUP_INTERVAL=15m
SESSION_SECURE_COOKIES=false
SESSION_HTTP_ONLY_COOKIES=true
SESSION_SAME_SITE_POLICY=Lax

# TOTP Configuration
TOTP_ISSUER=AuthService
TOTP_SECRET_LENGTH=20
TOTP_WINDOW_SIZE=1

# SMS Configuration
SMS_PROVIDER=console
SMS_API_KEY=
SMS_API_SECRET=
SMS_FROM_NUMBER=

# Email Configuration
EMAIL_PROVIDER=console
EMAIL_API_KEY=
EMAIL_FROM_EMAIL=noreply@authservice.com

# Push Notification Configuration
PUSH_PROVIDER=console
PUSH_API_KEY=

# Risk Assessment Configuration
RISK_BASE_RISK_SCORE=0.1
RISK_NEW_DEVICE=0.2
RISK_SUSPICIOUS_DEVICE=0.3
RISK_NEW_LOCATION=0.2
RISK_SUSPICIOUS_LOCATION=0.4
RISK_HIGH_RISK_COUNTRY=0.3
RISK_VPN=0.1
RISK_TOR=0.5
RISK_UNUSUAL_TIME=0.2
RISK_RECENT_FAILURES=0.3
RISK_NEW_ACCOUNT=0.1
RISK_UNUSUAL_BEHAVIOR=0.2
RISK_MFA_THRESHOLD=0.7
RISK_BLOCK_THRESHOLD=0.9
RISK_TRUSTED_DEVICES=true
RISK_GEO_FENCING=true
RISK_TIME_BASED_RULES=true

# Audit Configuration
AUDIT_RETENTION_DAYS=90
AUDIT_REAL_TIME_ALERTS=true

# PingAM Configuration
PINGAM_BASE_URL=http://localhost:1080
PINGAM_CLIENT_ID=auth-service-client
PINGAM_CLIENT_SECRET=your-client-secret
PINGAM_REDIRECT_URI=http://localhost:8085/callback
PINGAM_SCOPES=["openid", "profile", "email", "groups"]
PINGAM_TIMEOUT=30s
PINGAM_RETRY_ATTEMPTS=3
PINGAM_CACHE_TTL=5m
PINGAM_ENABLE_SSO=true
PINGAM_ENABLE_MFA=true
PINGAM_ENABLE_RISK_BASED=true
PINGAM_SAML_ENTITY_ID=auth-service
PINGAM_SAML_SSO_URL=https://pingam.company.com/saml/sso
PINGAM_SAML_SLO_URL=https://pingam.company.com/saml/slo
PINGAM_SAML_CERTIFICATE=/etc/ssl/pingam/cert.pem
PINGAM_SAML_PRIVATE_KEY=/etc/ssl/pingam/key.pem
PINGAM_SAML_ENABLED=true
PINGAM_OAUTH_AUTHORIZATION_URL=https://pingam.company.com/oauth/authorize
PINGAM_OAUTH_TOKEN_URL=https://pingam.company.com/oauth/token
PINGAM_OAUTH_USERINFO_URL=https://pingam.company.com/oauth/userinfo
PINGAM_OAUTH_SCOPES=["openid", "profile", "email", "groups"]
PINGAM_OAUTH_ENABLED=true
PINGAM_POLICY_URL=https://pingam.company.com/policy
PINGAM_POLICY_DECISION_URL=https://pingam.company.com/authorize
PINGAM_POLICY_ENABLE_RBAC=true
PINGAM_POLICY_ENABLED=true
PINGAM_SENSITIVE_FIELDS=["password", "secret", "token"]
PINGAM_ALERT_FAILED_LOGIN=5
PINGAM_ALERT_SUSPICIOUS_ACTIVITY=3

# Logging Configuration
LOG_LEVEL=info
LOG_FORMAT=json
LOG_OUTPUT=stdout
LOG_FILE_ENABLED=false
LOG_FILE_PATH=logs/auth-service.log
LOG_FILE_MAX_SIZE=100
LOG_FILE_MAX_BACKUPS=3
LOG_FILE_MAX_AGE=28
LOG_FILE_COMPRESS=true

# Kafka Configuration
KAFKA_BROKERS=["localhost:9092"]
KAFKA_GROUP_ID=auth-service
KAFKA_TOPIC_USER_EVENTS=user.events
KAFKA_TOPIC_AUTH_EVENTS=auth.events
KAFKA_TOPIC_AUDIT_LOGS=audit.logs
KAFKA_RETRY_COUNT=3
KAFKA_RETRY_BACKOFF=1s

# Security Configuration
SECURITY_PASSWORD_MIN_LENGTH=8
SECURITY_PASSWORD_MAX_LENGTH=128
SECURITY_MAX_LOGIN_ATTEMPTS=5
SECURITY_LOCKOUT_DURATION=15m
SECURITY_SESSION_TIMEOUT=24h
SECURITY_REQUIRE_EMAIL_VERIFICATION=false

# CORS Configuration
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=["http://localhost:3000", "http://localhost:8080", "http://localhost:8085"]
CORS_ALLOWED_METHODS=["GET", "POST", "PUT", "DELETE", "OPTIONS"]
CORS_ALLOWED_HEADERS=["Content-Type", "Authorization", "X-Requested-With"]

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# Health Check Configuration
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=5s

# Telemetry Configuration
TELEMETRY_ENABLED=true
TELEMETRY_SERVICE_NAME=auth-service
TELEMETRY_SERVICE_VERSION=1.0.0
TELEMETRY_ENVIRONMENT=development
TELEMETRY_OTLP_ENDPOINT=localhost:4318
TELEMETRY_JAEGER_ENDPOINT=http://localhost:14268/api/traces
TELEMETRY_PROMETHEUS_PORT=8888

# Monitoring Configuration
MONITORING_ENABLED=true
MONITORING_METRICS_ENABLED=true
MONITORING_TRACING_ENABLED=true
MONITORING_JAEGER_ENDPOINT=http://localhost:14268/api/traces
MONITORING_PROMETHEUS_ENDPOINT=http://localhost:9090

# Grafana Configuration
GRAFANA_ENABLED=true
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_URL=http://localhost:3000
GRAFANA_DASHBOARD_REFRESH_INTERVAL=30s

# Prometheus Configuration
PROMETHEUS_ENABLED=true
PROMETHEUS_URL=http://localhost:9090
PROMETHEUS_SCRAPE_INTERVAL=15s
PROMETHEUS_EVALUATION_INTERVAL=15s
PROMETHEUS_RETENTION_TIME=200h

# Authorization Configuration
AUTHORIZATION_MODE=jwt
AUTHORIZATION_ENABLED=true
JWT_AUTH_USE_ROLES=true
JWT_AUTH_USE_PERMISSIONS=true
JWT_AUTH_ROLES_CLAIM_KEY=roles
JWT_AUTH_PERMISSIONS_CLAIM_KEY=permissions
PINGAM_AUTH_ENABLED=false
PINGAM_AUTH_CACHE_TTL=5m
PINGAM_AUTH_FALLBACK_TO_JWT=true

# =======================================================================
# KEYCLOAK CONFIGURATION
# =======================================================================
# Generate secure client secrets using: make generate-secret
# For development: make generate-secret-dev
# For production: make generate-secret-prod

# Keycloak Server Configuration
KEYCLOAK_BASE_URL=http://localhost:8080
KEYCLOAK_REALM=master
KEYCLOAK_CLIENT_ID=auth-service-client

# Keycloak Client Secret - GENERATE SECURELY - DO NOT USE DEFAULTS IN PRODUCTION
# Run 'make generate-secret' to generate a secure secret
KEYCLOAK_CLIENT_SECRET=your-securely-generated-client-secret-here

# Keycloak OAuth2 Configuration
KEYCLOAK_REDIRECT_URI=http://localhost:8085/callback
KEYCLOAK_SCOPES=openid,profile,email,roles
KEYCLOAK_TIMEOUT=30s
KEYCLOAK_RETRY_ATTEMPTS=3
KEYCLOAK_CACHE_TTL=5m

# Keycloak Feature Flags
KEYCLOAK_ENABLE_SSO=true
KEYCLOAK_ENABLE_MFA=true
KEYCLOAK_ENABLE_RISK_BASED=false

# Keycloak Admin API (optional - for realm management)
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_ADMIN_ENABLED=false

# Keycloak SAML Configuration (optional)
KEYCLOAK_SAML_ENTITY_ID=auth-service
KEYCLOAK_SAML_SSO_URL=https://keycloak.example.com/realms/master/protocol/saml
KEYCLOAK_SAML_SLO_URL=https://keycloak.example.com/realms/master/protocol/saml
KEYCLOAK_SAML_CERT_PATH=/etc/ssl/keycloak/cert.pem
KEYCLOAK_SAML_KEY_PATH=/etc/ssl/keycloak/key.pem
KEYCLOAK_SAML_ENABLED=false

# Keycloak OAuth2 Endpoints (auto-configured from base_url + realm)
# KEYCLOAK_OAUTH_AUTH_URL=
# KEYCLOAK_OAUTH_TOKEN_URL=
# KEYCLOAK_OAUTH_USERINFO_URL=
# KEYCLOAK_OAUTH_LOGOUT_URL=
# KEYCLOAK_OAUTH_JWKS_URL=

# Keycloak Policy Configuration (optional)
KEYCLOAK_POLICY_URL=https://keycloak.example.com/realms/master/authz/protection/resource_set
KEYCLOAK_DECISION_URL=https://keycloak.example.com/realms/master/authz/protection/permission
KEYCLOAK_ENABLE_RBAC=true
KEYCLOAK_POLICY_ENABLED=false

# =======================================================================
# LEGACY ENVIRONMENT VARIABLES (DEPRECATED)
# =======================================================================
# The following variables are kept for backward compatibility.
# New deployments should use the standardized variable names above.
# These can be removed after full migration to the new naming convention.

# Legacy Database Variables
DB_HOST=localhost
DB_PORT=5432
DB_NAME=auth_service
DB_USER=auth_user
DB_PASSWORD=auth_password
DB_SSL_MODE=disable
DB_MAX_CONNECTIONS=25
DB_MAX_IDLE_CONNECTIONS=5
DB_CONNECTION_MAX_LIFETIME=1h

# Legacy Redis Variables
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=5
REDIS_MAX_RETRIES=3
REDIS_DIAL_TIMEOUT=5s
REDIS_READ_TIMEOUT=3s
REDIS_WRITE_TIMEOUT=3s

# Legacy Kafka Variables
KAFKA_BROKERS=localhost:9092
KAFKA_GROUP_ID=auth-service
KAFKA_TOPIC_USER_EVENTS=user.events
KAFKA_TOPIC_AUTH_EVENTS=auth.events
KAFKA_TOPIC_AUDIT_LOGS=audit.logs
KAFKA_RETRY_COUNT=3
KAFKA_RETRY_BACKOFF=1s

# Legacy JWT Variables
JWT_SECRET=your-secret-key-here-change-in-production
JWT_EXPIRATION=24h
JWT_ISSUER=auth-service
JWT_ALGORITHM=HS256

# Legacy Security Variables
SECURITY_PASSWORD_MIN_LENGTH=8
SECURITY_PASSWORD_MAX_LENGTH=128
SECURITY_MAX_LOGIN_ATTEMPTS=5
SECURITY_LOCKOUT_DURATION=15m
SECURITY_SESSION_TIMEOUT=24h
SECURITY_REQUIRE_EMAIL_VERIFICATION=false

# Legacy CORS Variables
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,http://localhost:8085
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Requested-With

# Legacy Rate Limiting Variables
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# Legacy Health Check Variables
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=5s

# Legacy Logging Variables
LOGGING_LEVEL=debug
LOGGING_FORMAT=json
LOGGING_OUTPUT=stdout
LOGGING_FILE_ENABLED=true
LOGGING_FILE_PATH=logs/auth-service.log
LOGGING_FILE_MAX_SIZE=100
LOGGING_FILE_MAX_BACKUPS=3
LOGGING_FILE_MAX_AGE=28
LOGGING_FILE_COMPRESS=true

# Legacy Server Variables
SERVER_READ_TIMEOUT=30s
SERVER_WRITE_TIMEOUT=30s
SERVER_IDLE_TIMEOUT=120s

# Legacy Cache Variables
CACHE_NAME=auth-cache
CACHE_USE_CLUSTER=false
CACHE_CLUSTER_ADDRS=

# Development Configuration
DEV_MODE=true
DEV_AUTO_RELOAD=true
DEV_HOT_RELOAD=true

# Production Configuration
PROD_MODE=false
PROD_HTTPS_ENABLED=false
PROD_TLS_CERT_PATH=
PROD_TLS_KEY_PATH=

# Monitoring Configuration
MONITORING_ENABLED=true
MONITORING_METRICS_ENABLED=true
MONITORING_TRACING_ENABLED=false
MONITORING_JAEGER_ENDPOINT=

# External Services
EXTERNAL_EMAIL_SERVICE_URL=
EXTERNAL_SMS_SERVICE_URL=
EXTERNAL_NOTIFICATION_SERVICE_URL=

# Feature Flags
FEATURE_EMAIL_VERIFICATION=true
FEATURE_SMS_VERIFICATION=false
FEATURE_2FA_ENABLED=false
FEATURE_SSO_ENABLED=false
FEATURE_AUDIT_LOGGING=true
FEATURE_RATE_LIMITING=true
FEATURE_CACHING=true

# Development Tools
DEV_SWAGGER_ENABLED=true
DEV_SWAGGER_PATH=/swagger
DEV_PPROF_ENABLED=true
DEV_PPROF_PATH=/debug/pprof

# Testing Configuration
TEST_DB_HOST=localhost
TEST_DB_PORT=5432
TEST_DB_NAME=auth_service_test
TEST_DB_USER=auth_user
TEST_DB_PASSWORD=auth_password
TEST_REDIS_HOST=localhost
TEST_REDIS_PORT=6379
TEST_KAFKA_BROKERS=localhost:9092