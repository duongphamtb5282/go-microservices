# Backend Core Configuration

# Database configuration
database:
  type: postgresql              # postgresql, mongodb
  host: localhost
  port: 5432                    # 5432 for PostgreSQL, 27017 for MongoDB
  database: microservices
  username: postgres
  password: password
  ssl_mode: disable              # disable, require, verify-ca, verify-full
  max_open_conns: 100
  max_idle_conns: 10
  conn_max_lifetime: 1h
  conn_max_idle_time: 30m
  log_level: info                # silent, error, warn, info
  slow_threshold: 200ms
  
  # PostgreSQL-specific configuration
  postgresql:
    host: localhost
    port: 5432
    database: microservices
    username: postgres
    password: password
    ssl_mode: disable
    params:
      connect_timeout: "30"
      statement_timeout: "30000"
      idle_in_transaction_session_timeout: "300000"
  
  # MongoDB-specific configuration
  mongodb:
    coll: "users"                    # collection name
    options: "replicaSet=rs0&authSource=admin&retryWrites=true&w=majority"  # mongodb options
    database: microservices          # database name
    username: ""                     # 用户名
    password: ""                     # 密码
    auth-source: "admin"             # 验证数据库
    min-pool-size: 10                # 最小连接池
    max-pool-size: 100               # 最大连接池
    socket-timeout-ms: 30000         # socket超时时间
    connect-timeout-ms: 10000        # 连接超时时间
    is-zap: true                     # 是否开启zap日志
    hosts:                           # 主机列表
      - host: "localhost"
        port: "27017"

# Redis configuration
redis:
  name: "microservices-redis"    # Redis instance name
  addr: "localhost:6379"         # Redis server address:port
  password: ""                   # Leave empty if no password
  db: 0                          # Database number (0-15)
  useCluster: false              # Enable cluster mode
  clusterAddrs: []               # Cluster node addresses (when useCluster: true)
  pool_size: 10                  # Connection pool size

# Logging configuration
logging:
  level: info                    # debug, info, warn, error, fatal
  format: json                   # json, console
  output: stdout                 # stdout, stderr, file
  file_path: logs/app.log
  max_size: 100                  # MB
  max_backups: 3
  max_age: 28                    # days
  compress: true                 # Compress old log files

# Zap logger configuration
zap:
  level: "info"                  # Log level: debug, info, warn, error, fatal, panic (required)
  prefix: "[microservices]"      # Log prefix
  format: "json"                 # Output format: json, console (required)
  directory: "logs"              # Log directory (required)
  encode-level: "Lowercase"      # Encode level: Lowercase, LowercaseColor, Capital, CapitalColor (required)
  stacktrace-key: "stacktrace"   # Stack trace key
  show-line: true                # Show line numbers
  log-in-console: true           # Log to console
  retention-day: 7               # Log retention days
  
  # Log rotation settings (all required)
  max-size: 100                  # Max file size in MB (required)
  max-backups: 5                 # Number of backup files to keep (required)
  max-age: 30                    # Max age of log files in days (required)
  compress: true                 # Compress old log files
  local-time: true               # Use local time for rotation
  rotation-type: "both"          # Rotation type: size, time, both (required)

# Security configuration
security:
  jwt_secret: your-secret-key-change-this-in-production
  jwt_expiration: 24h
  issuer: microservices
  audience: microservices-clients
  bcrypt_cost: 12

# Sensitive data masking configuration
masking:
  enabled: true
  environment: "production"
  security_level: "production"
  
  # Specific field rules
  rules:
    - field: "password"
      level: "full_mask"
      pattern: "********"
      environment: "production"
    
    - field: "secret"
      level: "full_mask"
      pattern: "********"
      environment: "production"
    
    - field: "token"
      level: "partial_mask"
      visible: 4
      environment: "production"
    
    - field: "email"
      level: "partial_mask"
      visible: 3
      pattern: "***@***.***"
      environment: "production"
    
    - field: "credit_card"
      level: "full_mask"
      pattern: "****-****-****-####"
      environment: "production"
  
  # Global regex rules
  global_rules:
    - field: ".*password.*"
      level: "full_mask"
      is_regex: true
    
    - field: ".*secret.*"
      level: "full_mask"
      is_regex: true
    
    - field: ".*key.*"
      level: "full_mask"
      is_regex: true
    
    - field: ".*token.*"
      level: "partial_mask"
      visible: 4
      is_regex: true
  
  # Field-specific rules
  field_rules: {}
  
  # Cache configuration
  cache:
    enabled: true
    ttl: 5m
    size: 1000
  
  # Audit configuration
  audit:
    enabled: true
    log_level: "info"
    include_data: false
